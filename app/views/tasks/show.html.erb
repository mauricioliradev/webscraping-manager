<div class="mb-6">
  <%= link_to "← Voltar para lista", tasks_path, class: "text-sm font-medium text-gray-500 hover:text-gray-900" %>
</div>

<div class="overflow-hidden bg-white shadow sm:rounded-lg">
  <div class="px-4 py-5 sm:px-6 flex justify-between items-center bg-gray-50 border-b border-gray-200">
    <div>
      <h3 class="text-base font-semibold leading-6 text-gray-900">Detalhes da Coleta #<%= @task.id %></h3>
      <p class="mt-1 max-w-2xl text-sm text-gray-500">Informações técnicas e resultados.</p>
    </div>
    <span class="inline-flex items-center rounded-md bg-gray-100 px-2.5 py-0.5 text-sm font-medium text-gray-800">
      <%= @task.status.upcase %>
    </span>
  </div>
  
  <div class="border-t border-gray-200">
    <dl>
      <div class="bg-white px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
        <dt class="text-sm font-medium text-gray-500">Título</dt>
        <dd class="mt-1 text-sm text-gray-900 sm:col-span-2 sm:mt-0"><%= @task.title %></dd>
      </div>
      <div class="bg-gray-50 px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
        <dt class="text-sm font-medium text-gray-500">URL Alvo</dt>
        <dd class="mt-1 text-sm text-blue-600 sm:col-span-2 sm:mt-0 truncate">
          <a href="<%= @task.url %>" target="_blank" class="hover:underline"><%= @task.url %></a>
        </dd>
      </div>

      <% if @task.completed? && @task.result.present? %>
        <div class="bg-white px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6 border-t border-gray-100">
          <dt class="text-sm font-medium text-gray-500 self-center">Resultado Coletado</dt>
          <dd class="mt-1 text-sm text-gray-900 sm:col-span-2 sm:mt-0">
            <div class="rounded-md bg-green-50 border border-green-100 p-4">
              <div class="flex items-baseline justify-between mb-2">
                <h4 class="text-lg font-bold text-green-900"><%= @task.result['brand'] %> <%= @task.result['model'] %></h4>
                <span class="text-xl font-extrabold text-green-700"><%= @task.result['price'] %></span>
              </div>
              <p class="text-green-800 text-sm"><%= @task.result['description'] %></p>
            </div>
            
            <details class="mt-4">
              <summary class="cursor-pointer text-xs text-gray-400 hover:text-gray-600">Ver JSON bruto</summary>
              <pre class="mt-2 w-full overflow-x-auto rounded bg-gray-900 p-4 text-xs text-gray-50"><%= JSON.pretty_generate(@task.result) %></pre>
            </details>
          </dd>
        </div>
      <% elsif @task.failed? %>
         <div class="bg-red-50 px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
          <dt class="text-sm font-medium text-red-500">Erro</dt>
          <dd class="mt-1 text-sm text-red-700 sm:col-span-2 sm:mt-0 font-mono"><%= @task.error_message %></dd>
        </div>
      <% end %>
    </dl>
  </div>
</div>